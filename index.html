<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High Performance Hub - GHN</title>
    <!-- Chosen Palette: Corporate Calm (Slate Gray, Sky Blue, White) -->
    <!-- Application Structure Plan: A single-page dashboard application is designed for optimal user experience in data management. It features a persistent sidebar for primary navigation, a header with global controls (year filter), and a dynamic main content area. This structure allows users to maintain context (selected year) while seamlessly switching between different data modules (Dashboard, Performance, Talent, etc.). This dashboard approach was chosen over a linear report format to facilitate non-linear exploration and comparative analysis across years, which is a core user requirement. Gemini API features are added to provide AI-driven insights and suggestions. Direct data entry via modals is now supported. -->
    <!-- Visualization & Content Choices: 
        - Dashboard: KPI cards (HTML/CSS) for at-a-glance metrics. Timeline (HTML/CSS) to show key events. Donut Chart (Chart.js) for participant distribution. Goal: Inform. Interaction: Year filter. Gemini API button added for AI analysis.
        - Performance Management: "Performance Feedback Assistant" feature using Gemini API to generate constructive feedback from manager's notes. Goal: Assist & Empower. Interaction: Text input and button click.
        - Talent Development: Tabbed interface (HTML/CSS/JS) to organize multiple programs cleanly. Gemini API button on "Fast Track" tab to generate behavioral interview questions. Includes a form modal to add new programs. Goal: Organize & Standardize. Interaction: Clicking tabs and buttons.
        - Learning Academy: "Course Outline Assistant" feature using Gemini API to generate course structures from a topic. Goal: Create & Standardize. Interaction: Text input and button click.
        - Participant Directory: Interactive table (HTML/CSS/JS) with live search, an "Add New" button, and "Edit" buttons on each row, all using a form modal. Goal: Organize & Act. Interaction: Search input, click buttons for AI generation and data entry.
        - Admin Page: "AI Drafting Assistant" and "Job Description Assistant" features using Gemini API. A new section for editing yearly KPIs via a form modal. Goal: Assist & Manage. Interaction: Text input and button clicks.
        - Justification: These choices translate the static report data into an interactive system, allowing users to query and analyze information dynamically instead of just reading it. Chart.js is used for all quantitative data visualization. Gemini API integration enhances the app's value by providing actionable, AI-generated content.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        .sidebar-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        /* Modal Styles */
        .modal-container {
            transition: opacity 0.3s ease;
        }
        .gemini-spinner {
            border-top-color: #38bdf8;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-slate-800 text-white flex flex-col shrink-0">
            <div class="h-16 flex items-center justify-center text-xl font-bold border-b border-slate-700">
                <span class="sidebar-icon mr-2">üìä</span>
                <span>Performance Hub</span>
            </div>
            <nav class="flex-1 px-4 py-4">
                <ul id="sidebar-nav">
                    <li><a href="#" data-page="dashboard" class="flex items-center px-4 py-3 my-1 rounded-lg"><span class="sidebar-icon mr-3">üè†</span><span>B·∫£ng ƒëi·ªÅu khi·ªÉn</span></a></li>
                    <li><a href="#" data-page="performance" class="flex items-center px-4 py-3 my-1 rounded-lg"><span class="sidebar-icon mr-3">üéØ</span><span>Qu·∫£n l√Ω Hi·ªáu su·∫•t</span></a></li>
                    <li><a href="#" data-page="talent" class="flex items-center px-4 py-3 my-1 rounded-lg"><span class="sidebar-icon mr-3">üíº</span><span>Ph√°t tri·ªÉn T√†i nƒÉng</span></a></li>
                    <li><a href="#" data-page="academy" class="flex items-center px-4 py-3 my-1 rounded-lg"><span class="sidebar-icon mr-3">üéì</span><span>H·ªçc vi·ªán ƒê√†o t·∫°o</span></a></li>
                    <li><a href="#" data-page="participants" class="flex items-center px-4 py-3 my-1 rounded-lg"><span class="sidebar-icon mr-3">üë•</span><span>Danh b·∫° Th√†nh vi√™n</span></a></li>
                    <li><a href="#" data-page="admin" class="flex items-center px-4 py-3 my-1 rounded-lg"><span class="sidebar-icon mr-3">‚öôÔ∏è</span><span>B√°o c√°o & Qu·∫£n tr·ªã</span></a></li>
                </ul>
            </nav>
            <div class="p-4 border-t border-slate-700 text-sm text-slate-400">
                <p>¬© 2025 GHN Performance Hub</p>
                <p>Phi√™n b·∫£n 1.6.1 ‚ú®</p>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shrink-0">
                <div>
                    <h1 id="header-title" class="text-xl font-semibold">B·∫£ng ƒëi·ªÅu khi·ªÉn</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">üîç</span>
                        <input id="search-input" type="text" placeholder="T√¨m ki·∫øm th√†nh vi√™n..." class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500">
                    </div>
                    <select id="year-selector" class="w-32 px-4 py-2 bg-slate-100 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-200 focus:outline-none">
                        <option value="2024">NƒÉm 2024</option>
                        <option value="2025" selected>NƒÉm 2025</option>
                        <option value="2026">NƒÉm 2026</option>
                    </select>
                </div>
            </header>

            <!-- Page Content Area -->
            <main class="flex-1 overflow-y-auto p-6">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-800">T·ªïng quan nƒÉm <span class="year-label"></span></h2>
                        <button id="gemini-analyze-kpi" class="bg-gradient-to-r from-purple-500 to-sky-500 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:scale-105 transition-transform">
                            ‚ú® Ph√¢n t√≠ch & ƒê·ªÅ xu·∫•t
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6" id="kpi-widgets-container">
                        <!-- KPI Widgets will be rendered here -->
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm">
                            <h2 class="text-xl font-semibold text-slate-700 mb-4">D√≤ng th·ªùi gian s·ª± ki·ªán</h2>
                            <div id="timeline-container" class="relative border-l-2 border-sky-200 pl-6 space-y-8">
                                <!-- Timeline items will be rendered here -->
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <h2 class="text-xl font-semibold text-slate-700 mb-4">Ph√¢n b·ªï th√†nh vi√™n</h2>
                            <div class="chart-container">
                                <canvas id="distribution-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Management Page -->
                <div id="performance-page" class="page">
                     <p class="mb-6 text-slate-600">Module Qu·∫£n l√Ω Hi·ªáu su·∫•t cung c·∫•p c√°i nh√¨n t·ªïng quan v·ªÅ quy tr√¨nh, ho·∫°t ƒë·ªông v√† k·∫øt qu·∫£ c·ªßa c√°c ch∆∞∆°ng tr√¨nh ƒë√°nh gi√° v√† ph√°t tri·ªÉn hi·ªáu su·∫•t trong nƒÉm. T·∫°i ƒë√¢y, b·∫°n c√≥ th·ªÉ theo d√µi c√°c m·ªëc th·ªùi gian quan tr·ªçng v√† xem c√°c s·ªë li·ªáu th·ªëng k√™ v·ªÅ m·ª©c ƒë·ªô ho√†n th√†nh v√† hi·ªáu qu·∫£ c·ªßa ch∆∞∆°ng tr√¨nh.</p>
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <h2 class="text-xl font-semibold text-slate-700 mb-4">K·∫øt qu·∫£ ƒë√†o t·∫°o Qu·∫£n l√Ω Hi·ªáu su·∫•t</h2>
                             <div class="chart-container">
                                <canvas id="pm-results-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                             <h2 class="text-xl font-semibold text-slate-700 mb-4">‚ú® Tr·ª£ l√Ω Ph·∫£n h·ªìi Hi·ªáu su·∫•t</h2>
                             <div class="space-y-3">
                                <textarea id="feedback-input" rows="4" placeholder="Nh·∫≠p c√°c quan s√°t ch√≠nh v·ªÅ nh√¢n vi√™n...&#10;VD: - Ho√†n th√†nh t·ªët d·ª± √°n X tr∆∞·ªõc th·ªùi h·∫°n.&#10;- C·∫ßn c·∫£i thi·ªán k·ªπ nƒÉng thuy·∫øt tr√¨nh tr∆∞·ªõc ƒë√°m ƒë√¥ng." class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"></textarea>
                                <button id="gemini-feedback-button" class="w-full flex items-center justify-center px-4 py-3 bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition-colors">
                                    T·∫°o g·ª£i √Ω ph·∫£n h·ªìi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Talent Development Page -->
                <div id="talent-page" class="page">
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-slate-600">Kh√°m ph√° chi ti·∫øt t·ª´ng ch∆∞∆°ng tr√¨nh, t·ª´ m·ª•c ti√™u, l·ªô tr√¨nh ƒë·∫øn c√°c k·∫øt qu·∫£ ƒë·∫°t ƒë∆∞·ª£c.</p>
                        <button id="add-program-button" class="bg-green-500 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-green-600 transition-colors">Th√™m Ch∆∞∆°ng tr√¨nh m·ªõi</button>
                    </div>
                    <div id="talent-tabs-container">
                        <!-- Talent development content will be rendered here -->
                    </div>
                </div>

                <!-- Academy Page -->
                <div id="academy-page" class="page">
                     <p class="mb-6 text-slate-600">Module H·ªçc vi·ªán ƒê√†o t·∫°o gi·ªõi thi·ªáu v·ªÅ c√°c ch∆∞∆°ng tr√¨nh v√† khung nƒÉng l·ª±c ƒë∆∞·ª£c x√¢y d·ª±ng nh·∫±m ph√°t tri·ªÉn to√†n di·ªán cho ƒë·ªôi ng≈©. S·ª≠ d·ª•ng Tr·ª£ l√Ω Thi·∫øt k·∫ø Kh√≥a h·ªçc ƒë·ªÉ nhanh ch√≥ng x√¢y d·ª±ng c√°c ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o m·ªõi.</p>
                     <div class="bg-white p-6 rounded-xl shadow-sm">
                         <h2 class="text-xl font-semibold text-slate-700 mb-4">‚ú® Tr·ª£ l√Ω Thi·∫øt k·∫ø Kh√≥a h·ªçc</h2>
                         <div class="space-y-3">
                            <input id="course-topic-input" type="text" placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ kh√≥a h·ªçc, VD: Qu·∫£n l√Ω d·ª± √°n cho ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500">
                            <button id="gemini-course-button" class="w-full flex items-center justify-center px-4 py-3 bg-teal-500 text-white rounded-lg hover:bg-teal-600 transition-colors">
                                T·∫°o ƒë·ªÅ c∆∞∆°ng kh√≥a h·ªçc
                            </button>
                        </div>
                     </div>
                </div>

                <!-- Participants Page -->
                <div id="participants-page" class="page">
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-slate-600">S·ª≠ d·ª•ng thanh t√¨m ki·∫øm ƒë·ªÉ l·ªçc, ho·∫∑c s·ª≠ d·ª•ng c√°c tr·ª£ l√Ω AI v√† c√¥ng c·ª• qu·∫£n l√Ω.</p>
                        <button id="add-participant-button" class="bg-green-500 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-green-600 transition-colors">Th√™m Th√†nh vi√™n m·ªõi</button>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b border-slate-200">
                                <tr>
                                    <th class="p-4 text-sm font-semibold text-slate-600">H·ªç v√† t√™n</th>
                                    <th class="p-4 text-sm font-semibold text-slate-600">Ch∆∞∆°ng tr√¨nh</th>
                                    <th class="p-4 text-sm font-semibold text-slate-600">Tr·∫°ng th√°i</th>
                                    <th class="p-4 text-sm font-semibold text-slate-600 text-center">H√†nh ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody id="participants-table-body">
                                <!-- Participant rows will be rendered here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Admin Page -->
                <div id="admin-page" class="page">
                    <p class="mb-6 text-slate-600">Khu v·ª±c qu·∫£n tr·ªã d√†nh cho vi·ªác qu·∫£n l√Ω d·ªØ li·ªáu to√†n h·ªá th·ªëng. T·∫°i ƒë√¢y, b·∫°n c√≥ th·ªÉ th·ª±c hi·ªán c√°c t√°c v·ª• quan tr·ªçng nh∆∞ nh·∫≠p/xu·∫•t d·ªØ li·ªáu ho·∫∑c s·ª≠ d·ª•ng c√°c tr·ª£ l√Ω AI ƒë·ªÉ tƒÉng t·ªëc c√¥ng vi·ªác.</p>
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <h2 class="text-xl font-semibold text-slate-700 mb-4">Qu·∫£n l√Ω KPI theo nƒÉm</h2>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3 text-sm font-semibold text-slate-600">NƒÉm</th>
                                            <th class="p-3 text-sm font-semibold text-slate-600">Th√†nh vi√™n</th>
                                            <th class="p-3 text-sm font-semibold text-slate-600">Nh√¢n t√†i</th>
                                            <th class="p-3 text-sm font-semibold text-slate-600">T·ª∑ l·ªá</th>
                                            <th class="p-3 text-sm font-semibold text-slate-600">Kh√≥a h·ªçc</th>
                                            <th class="p-3 text-sm font-semibold text-slate-600">S·ª≠a</th>
                                        </tr>
                                    </thead>
                                    <tbody id="kpi-table-body">
                                        <!-- KPI rows will be rendered here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <h2 class="text-xl font-semibold text-slate-700 mb-4">‚ú® Tr·ª£ l√Ω M√¥ t·∫£ C√¥ng vi·ªác</h2>
                            <div class="space-y-3">
                                <input id="jd-title-input" type="text" placeholder="Ch·ª©c danh, VD: Chuy√™n vi√™n Nh√¢n s·ª±" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500">
                                <textarea id="jd-responsibilities-input" rows="2" placeholder="Tr√°ch nhi·ªám ch√≠nh, m·ªói √Ω m·ªôt d√≤ng..." class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"></textarea>
                                <button id="gemini-jd-button" class="w-full flex items-center justify-center px-4 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                                    T·∫°o M√¥ t·∫£ C√¥ng vi·ªác
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modals Container -->
    <div id="modal-container"></div>
    
<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DATA ---
    let appData = {
        2024: {
            kpis: { total: 120, talent: 15, rate: 88, courses: 35 },
            timeline: [ { q: 'Q1', event: 'ƒê√°nh gi√° hi·ªáu su·∫•t 2023' }, { q: 'Q2', event: 'Workshop L√£nh ƒë·∫°o c·∫•p trung' }, { q: 'Q3', event: 'ƒê√°nh gi√° gi·ªØa nƒÉm 2024' }, { q: 'Q4', event: 'T·ªïng k·∫øt v√† vinh danh nh√¢n t√†i' }, ],
            participants: [ { id: 1, name: 'Nguy·ªÖn VƒÉn An', program: 'Middle Managers', status: 'ƒê√£ ho√†n th√†nh' }, { id: 2, name: 'Tr·∫ßn Th·ªã B√¨nh', program: 'Fast Track', status: 'ƒê√£ ho√†n th√†nh' }, ],
            pm: { results: { trained: 95, oneOnOne: 92, satisfied: 96 } },
            talent: [ { name: "Fast Track", goal: "Tuy·ªÉn 5 nh√¢n t√†i", result: "Tuy·ªÉn ƒë∆∞·ª£c 2 nh√¢n t√†i."}, { name: "Middle Managers", goal: "Ph√°t tri·ªÉn 10 qu·∫£n l√Ω", result: "8/10 ho√†n th√†nh xu·∫•t s·∫Øc."}, ]
        },
        2025: {
            kpis: { total: 160, talent: 22, rate: 91, courses: 42 },
            timeline: [ { q: 'Q1', event: 'ƒê√°nh gi√° PA2024 & WS L·∫≠p k·∫ø ho·∫°ch (IDP)' }, { q: 'Q2', event: 'T·ªï ch·ª©c Workshop 1, 2 & ƒê√°nh gi√° gi·ªØa nƒÉm (MYR)' }, { q: 'Q3', event: 'V√≤ng 2 "∆Ø∆°m m·∫ßm L√£nh ƒë·∫°o" & K√Ω MOU v·ªõi 2 ƒêH' }, { q: 'Q4', event: 'Chu·∫©n b·ªã PA2025, ch·ªët danh s√°ch Promote' }, ],
            participants: [ { id: 3, name: 'L√™ Ho√†ng C∆∞·ªùng', program: '∆Ø∆°m m·∫ßm L√£nh ƒë·∫°o', status: 'ƒê√£ ho√†n th√†nh' }, { id: 4, name: 'Ph·∫°m Th·ªã Dung', program: 'Middle Managers', status: 'ƒêang tham gia' }, { id: 5, name: 'V√µ Minh H·∫£i', program: 'Fast Track External Talent', status: 'ƒêang tham gia' }, { id: 6, name: 'ƒê·ªó Thu·ª≥ Linh', program: '∆Ø∆°m m·∫ßm L√£nh ƒë·∫°o', status: 'ƒê√£ ho√†n th√†nh' }, { id: 7, name: 'Ho√†ng Qu·ªëc Vi·ªát', program: 'Middle Managers', status: 'ƒê√£ ho√†n th√†nh' }, ],
            pm: { results: { trained: 98, oneOnOne: 95.6, satisfied: 98 } },
            talent: [ { name: "Fast Track External Talent", goal: "Tuy·ªÉn 5 nh√¢n t√†i b√™n ngo√†i.", result: "Tuy·ªÉn th√†nh c√¥ng 3 nh√¢n t√†i. Onboarding th√°ng 8."}, { name: "Middle Managers Program", goal: "Ph√°t tri·ªÉn qu·∫£n l√Ω c·∫•p trung n·ªôi b·ªô.", result: "T·ªï ch·ª©c c√°c workshop IDP, Mentoring, Functional. Chu·∫©n b·ªã ch·ªët danh s√°ch thƒÉng ch·ª©c Q4."}, { name: "∆Ø∆°m m·∫ßm l√£nh ƒë·∫°o", goal: "Ph√°t tri·ªÉn 7 Freights Managers.", result: "V∆∞·ª£t m·ª•c ti√™u, ph√°t tri·ªÉn 9 Freights Managers. Top 15 tham gia b·ªìi d∆∞·ª°ng sau V√≤ng 2 th√°ng 7."}, { name: "H·ª£p t√°c Gi√°o d·ª•c", goal: "K√Ω MOU v·ªõi c√°c tr∆∞·ªùng ƒêH.", result: "K√Ω k·∫øt th√†nh c√¥ng v·ªõi 2 tr∆∞·ªùng trong Qu√Ω 3."}, ]
        },
        2026: {
            kpis: { total: 200, talent: 30, rate: 95, courses: 50 },
            timeline: [ { q: 'Q1', event: 'Kh·ªüi ƒë·ªông ch∆∞∆°ng tr√¨nh Ph√°t tri·ªÉn B·ªÅn v·ªØng' }, { q: 'Q2', event: 'H·ªôi th·∫£o Chuy·ªÉn ƒë·ªïi s·ªë trong Nh√¢n s·ª±' }, { q: 'Q3', event: 'Ch∆∞∆°ng tr√¨nh Trao ƒë·ªïi nh√¢n t√†i qu·ªëc t·∫ø' }, { q: 'Q4', event: 'L·ªÖ vinh danh "GHN Stars 2026"' }, ],
            participants: [ { id: 8, name: 'Tr·ªãnh Th·ªã Mai', program: 'Fast Track', status: 'ƒê√£ ho√†n th√†nh' }, { id: 9, name: 'Ng√¥ Gia Huy', program: 'Middle Managers', status: 'ƒêang tham gia' }, ],
            pm: { results: { trained: 100, oneOnOne: 98, satisfied: 99 } },
            talent: [ { name: "Global Talent Exchange", goal: "G·ª≠i 5 nh√¢n t√†i ra n∆∞·ªõc ngo√†i.", result: "ƒêang trong qu√° tr√¨nh l·ª±a ch·ªçn."}, { name: "Digital Leadership", goal: "ƒê√†o t·∫°o 20 l√£nh ƒë·∫°o s·ªë.", result: "Ch∆∞∆°ng tr√¨nh d·ª± ki·∫øn kh·ªüi ƒë·ªông v√†o Qu√Ω 3."}, ]
        },
    };

    // --- STATE ---
    let state = { currentPage: 'dashboard', selectedYear: '2025', searchTerm: '' };
    let charts = {};

    // --- DOM ELEMENTS ---
    const sidebarNav = document.getElementById('sidebar-nav');
    const yearSelector = document.getElementById('year-selector');
    const searchInput = document.getElementById('search-input');
    const headerTitle = document.getElementById('header-title');
    const pages = document.querySelectorAll('.page');
    const kpiContainer = document.getElementById('kpi-widgets-container');
    const timelineContainer = document.getElementById('timeline-container');
    const participantsTableBody = document.getElementById('participants-table-body');
    const talentTabsContainer = document.getElementById('talent-tabs-container');
    const modalContainer = document.getElementById('modal-container');
    const kpiTableBody = document.getElementById('kpi-table-body');

    // --- MODAL & FORM HANDLING ---
    function showModal(content) {
        modalContainer.innerHTML = content;
        const modal = modalContainer.querySelector('.modal-container');
        modal.classList.remove('hidden');
        setTimeout(() => modal.classList.remove('opacity-0'), 10);
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal || e.target.closest('.close-modal-button')) {
                hideModal(modal);
            }
        });
    }

    function hideModal(modal) {
        if (!modal) modal = modalContainer.querySelector('.modal-container');
        if (modal) {
            modal.classList.add('opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                modalContainer.innerHTML = '';
            }, 300);
        }
    }

    function createFormModal(title, formId, formContent, submitLabel) {
        return `
            <div class="modal-container fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg">
                    <form id="${formId}">
                        <div class="flex justify-between items-center p-4 border-b">
                            <h3 class="text-lg font-semibold text-slate-800">${title}</h3>
                            <button type="button" class="close-modal-button text-slate-500 hover:text-slate-800 text-2xl font-bold">&times;</button>
                        </div>
                        <div class="p-6 space-y-4">${formContent}</div>
                        <div class="flex justify-end p-4 bg-slate-50 rounded-b-xl">
                            <button type="button" class="close-modal-button px-4 py-2 bg-slate-200 text-slate-700 rounded-lg mr-2 hover:bg-slate-300">H·ªßy</button>
                            <button type="submit" class="px-4 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600">${submitLabel}</button>
                        </div>
                    </form>
                </div>
            </div>`;
    }
    
    // --- GEMINI API FUNCTION ---
    async function callGeminiAPI(prompt) {
        showModal(createFormModal('‚ú® Ph√¢n t√≠ch t·ª´ Gemini', 'gemini-form', `
            <div id="gemini-loading" class="text-center py-10">
                <div class="gemini-spinner w-12 h-12 rounded-full border-4 border-slate-200 mx-auto"></div>
                <p class="mt-4 text-slate-600">ƒêang x·ª≠ l√Ω, vui l√≤ng ch·ªù...</p>
            </div>
            <div id="gemini-result" class="prose max-w-none text-slate-700 hidden"></div>
        `, 'ƒê√≥ng'));
        
        const apiKey = ""; // Leave empty
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

        try {
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
            const result = await response.json();
            if (result.candidates && result.candidates[0]?.content?.parts[0]) {
                showGeminiResult(result.candidates[0].content.parts[0].text);
            } else {
                showGeminiResult("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi h·ª£p l·ªá t·ª´ AI. Vui l√≤ng th·ª≠ l·∫°i.");
            }
        } catch (error) {
            console.error("Gemini API Error:", error);
            showGeminiResult(`ƒê√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi ƒë·∫øn AI: ${error.message}`);
        }
    }

    function showGeminiResult(text) {
        const loadingEl = document.getElementById('gemini-loading');
        const resultEl = document.getElementById('gemini-result');
        if(!loadingEl || !resultEl) return;
        
        loadingEl.classList.add('hidden');
        let formattedContent = text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/^- (.*)/gm, '<li class="ml-4 list-disc">$1</li>')
            .replace(/(<\/li>)(<li)/g, '$1\n$2') 
            .replace(/^(1\.|2\.|3\.|4\.|5\.) (.*)/gm, '<p class="mt-2"><strong>$1</strong> $2</p>')
            .replace(/\n/g, '<br>');
        resultEl.innerHTML = formattedContent;
        resultEl.classList.remove('hidden');
    }

    // --- RENDER FUNCTIONS ---
    const render = () => {
        const activeLink = sidebarNav.querySelector(`[data-page="${state.currentPage}"]`);
        headerTitle.textContent = activeLink.textContent;
        pages.forEach(p => p.classList.remove('active'));
        document.getElementById(`${state.currentPage}-page`).classList.add('active');
        sidebarNav.querySelectorAll('a').forEach(a => a.classList.remove('bg-sky-600', 'text-white'));
        activeLink.classList.add('bg-sky-600', 'text-white');
        document.querySelectorAll('.year-label').forEach(el => el.textContent = state.selectedYear);
        const data = appData[state.selectedYear];
        if (!data) return;
        renderDashboard(data);
        renderParticipants(data);
        renderPerformanceManagement(data);
        renderTalentDevelopment(data);
        renderAdminPage();
    };

    const renderDashboard = (data) => {
        kpiContainer.innerHTML = `
            <div class="bg-white p-5 rounded-xl shadow-sm flex items-center space-x-4"><div class="p-3 rounded-full bg-sky-100 text-sky-600">üë•</div><div><p class="text-slate-500 text-sm">T·ªïng th√†nh vi√™n</p><p class="text-2xl font-bold">${data.kpis.total}</p></div></div>
            <div class="bg-white p-5 rounded-xl shadow-sm flex items-center space-x-4"><div class="p-3 rounded-full bg-green-100 text-green-600">üíº</div><div><p class="text-slate-500 text-sm">Nh√¢n t√†i ph√°t tri·ªÉn</p><p class="text-2xl font-bold">${data.kpis.talent}</p></div></div>
            <div class="bg-white p-5 rounded-xl shadow-sm flex items-center space-x-4"><div class="p-3 rounded-full bg-yellow-100 text-yellow-600">üéØ</div><div><p class="text-slate-500 text-sm">T·ª∑ l·ªá ho√†n th√†nh</p><p class="text-2xl font-bold">${data.kpis.rate}%</p></div></div>
            <div class="bg-white p-5 rounded-xl shadow-sm flex items-center space-x-4"><div class="p-3 rounded-full bg-purple-100 text-purple-600">üéì</div><div><p class="text-slate-500 text-sm">Kh√≥a h·ªçc t·ªï ch·ª©c</p><p class="text-2xl font-bold">${data.kpis.courses}</p></div></div>`;
        timelineContainer.innerHTML = data.timeline.map(item => `<div class="relative"><div class="absolute -left-[33px] top-1 w-5 h-5 bg-sky-500 rounded-full border-4 border-white"></div><p class="font-bold text-sky-600">${item.q}</p><p class="text-slate-700">${item.event}</p></div>`).join('');
        updateDistributionChart(data);
    };
    
    const renderPerformanceManagement = (data) => {
        updatePmResultsChart(data);
    };
    
    const renderTalentDevelopment = (data) => {
        const programs = data.talent;
        let tabButtons = programs.map((p, i) => `<button class="talent-tab py-2 px-4 font-semibold whitespace-nowrap ${i === 0 ? 'text-sky-600 border-b-2 border-sky-600' : 'text-slate-500'}" data-index="${i}">${p.name}</button>`).join('');
        let tabContents = programs.map((p, i) => {
            let extraButton = '';
            if (p.name.toLowerCase().includes("fast track")) {
                extraButton = `<button class="gemini-interview-questions bg-teal-500 text-white font-semibold px-3 py-1.5 rounded-lg shadow-md hover:scale-105 transition-transform text-sm whitespace-nowrap mt-3" data-program-name="${p.name}">‚ú® T·∫°o c√¢u h·ªèi ph·ªèng v·∫•n</button>`;
            }
            return `<div class="talent-content p-4 bg-white rounded-xl shadow-sm ${i === 0 ? '' : 'hidden'}" data-program-name="${p.name}">
                        <div class="flex justify-between items-start flex-wrap gap-4">
                            <div>
                                <h3 class="text-xl font-bold text-slate-800 mb-2">${p.name}</h3>
                                <p class="text-slate-600"><span class="font-semibold">M·ª•c ti√™u:</span> ${p.goal}</p>
                                <p class="text-slate-600"><span class="font-semibold">K·∫øt qu·∫£:</span> ${p.result}</p>
                            </div>
                            <button class="gemini-suggest-activity bg-gradient-to-r from-purple-500 to-sky-500 text-white font-semibold px-3 py-1.5 rounded-lg shadow-md hover:scale-105 transition-transform text-sm whitespace-nowrap" data-program-name="${p.name}">‚ú® G·ª£i √Ω Ho·∫°t ƒë·ªông</button>
                        </div>
                        ${extraButton}
                    </div>`;
        }).join('');

        talentTabsContainer.innerHTML = `<div class="flex border-b border-slate-200 mb-4 overflow-x-auto">${tabButtons}</div><div id="talent-content-container">${tabContents}</div>`;
    };

    const renderParticipants = (data) => {
        const filtered = data.participants.filter(p => p.name.toLowerCase().includes(state.searchTerm.toLowerCase()) || p.program.toLowerCase().includes(state.searchTerm.toLowerCase()));
        if (filtered.length === 0) {
            participantsTableBody.innerHTML = `<tr><td colspan="4" class="text-center p-6 text-slate-500">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£.</td></tr>`;
            return;
        }
        participantsTableBody.innerHTML = filtered.map(p => `
            <tr class="border-b border-slate-200 last:border-0 hover:bg-slate-50">
                <td class="p-4 text-slate-800">${p.name}</td>
                <td class="p-4 text-slate-600">${p.program}</td>
                <td class="p-4"><span class="px-2 py-1 text-xs font-semibold rounded-full ${p.status === 'ƒê√£ ho√†n th√†nh' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}">${p.status}</span></td>
                <td class="p-4 text-center space-x-2">
                    <button class="edit-participant-button text-sm text-blue-600 hover:text-blue-800 font-semibold" data-id="${p.id}">S·ª≠a</button>
                    <button class="gemini-suggest-idp text-sm text-sky-600 hover:text-sky-800 font-semibold" data-name="${p.name}" data-program="${p.program}" data-status="${p.status}">‚ú® G·ª£i √Ω IDP</button>
                </td>
            </tr>`).join('');
    };
    
    const renderAdminPage = () => {
        kpiTableBody.innerHTML = Object.keys(appData).map(year => {
            const kpis = appData[year].kpis;
            return `<tr class="border-b border-slate-200 last:border-0">
                        <td class="p-3 font-semibold">${year}</td>
                        <td class="p-3">${kpis.total}</td>
                        <td class="p-3">${kpis.talent}</td>
                        <td class="p-3">${kpis.rate}%</td>
                        <td class="p-3">${kpis.courses}</td>
                        <td class="p-3"><button class="edit-kpi-button text-sm text-blue-600 hover:text-blue-800 font-semibold" data-year="${year}">S·ª≠a</button></td>
                    </tr>`;
        }).join('');
    };
    
    // --- CHART FUNCTIONS ---
    const updateDistributionChart = (data) => {
        const ctx = document.getElementById('distribution-chart').getContext('2d');
        const labels = data.participants.map(p => p.program);
        const counts = labels.reduce((acc, curr) => (acc[curr] = (acc[curr] || 0) + 1, acc), {});
        if (charts.distribution) charts.distribution.destroy();
        charts.distribution = new Chart(ctx, { type: 'doughnut', data: { labels: Object.keys(counts), datasets: [{ data: Object.values(counts), backgroundColor: ['#38bdf8', '#34d399', '#facc15', '#a78bfa'], borderColor: '#fff', borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } });
    };
    
    const updatePmResultsChart = (data) => {
        const ctx = document.getElementById('pm-results-chart').getContext('2d');
        const pmResults = data.pm.results;
        if (charts.pmResults) charts.pmResults.destroy();
        charts.pmResults = new Chart(ctx, { type: 'bar', data: { labels: ['% QL ƒë∆∞·ª£c ƒë√†o t·∫°o', '% QL th·ª±c hi·ªán 1:1', '% NV h√†i l√≤ng'], datasets: [{ label: `K·∫øt qu·∫£ nƒÉm ${state.selectedYear} (%)`, data: [pmResults.trained, pmResults.oneOnOne, pmResults.satisfied], backgroundColor: ['#38bdf8', '#34d399', '#a78bfa'], borderRadius: 4, }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 100, ticks: { callback: (v) => v + '%' } } }, plugins: { legend: { display: false } } } });
    };

    // --- EVENT LISTENERS ---
    sidebarNav.addEventListener('click', (e) => { e.preventDefault(); const link = e.target.closest('a'); if (link?.dataset.page) { state.currentPage = link.dataset.page; render(); } });
    yearSelector.addEventListener('change', (e) => { state.selectedYear = e.target.value; render(); });
    searchInput.addEventListener('input', (e) => { state.searchTerm = e.target.value; if (state.currentPage === 'participants') renderParticipants(appData[state.selectedYear]); });
    searchInput.addEventListener('focus', () => { if (state.currentPage !== 'participants') { state.currentPage = 'participants'; render(); } });
    
    // --- FORM & MODAL EVENT LISTENERS ---
    document.body.addEventListener('click', (e) => {
        // Add Participant Button
        if (e.target.id === 'add-participant-button') {
            const formContent = `
                <input type="hidden" name="id" value="${Date.now()}">
                <div><label class="block text-sm font-medium text-slate-600 mb-1">H·ªç v√† t√™n</label><input type="text" name="full_name" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div>
                <div><label class="block text-sm font-medium text-slate-600 mb-1">Ch∆∞∆°ng tr√¨nh</label><input type="text" name="program_name" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div>
                <div><label class="block text-sm font-medium text-slate-600 mb-1">Tr·∫°ng th√°i</label><select name="status" class="w-full px-3 py-2 border border-slate-300 rounded-lg"><option value="ƒêang tham gia">ƒêang tham gia</option><option value="ƒê√£ ho√†n th√†nh">ƒê√£ ho√†n th√†nh</option></select></div>
            `;
            showModal(createFormModal('Th√™m Th√†nh vi√™n m·ªõi', 'add-participant-form', formContent, 'L∆∞u'));
        }

        // Add Program Button
        if (e.target.id === 'add-program-button') {
            const formContent = `
                <div><label class="block text-sm font-medium text-slate-600 mb-1">T√™n Ch∆∞∆°ng tr√¨nh</label><input type="text" name="program_name" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div>
                <div><label class="block text-sm font-medium text-slate-600 mb-1">M·ª•c ti√™u</label><textarea name="goal" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-lg"></textarea></div>
                <div><label class="block text-sm font-medium text-slate-600 mb-1">K·∫øt qu·∫£</label><textarea name="result" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-lg"></textarea></div>
            `;
            showModal(createFormModal(`Th√™m Ch∆∞∆°ng tr√¨nh cho nƒÉm ${state.selectedYear}`, 'add-program-form', formContent, 'L∆∞u'));
        }

        // Edit Participant Button (delegated)
        if (e.target.classList.contains('edit-participant-button')) {
            const id = parseInt(e.target.dataset.id);
            const participant = appData[state.selectedYear].participants.find(p => p.id === id);
            if (participant) {
                const formContent = `
                    <input type="hidden" name="id" value="${participant.id}">
                    <div><label class="block text-sm font-medium text-slate-600 mb-1">H·ªç v√† t√™n</label><input type="text" name="full_name" value="${participant.name}" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div>
                    <div><label class="block text-sm font-medium text-slate-600 mb-1">Ch∆∞∆°ng tr√¨nh</label><input type="text" name="program_name" value="${participant.program}" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div>
                    <div><label class="block text-sm font-medium text-slate-600 mb-1">Tr·∫°ng th√°i</label><select name="status" class="w-full px-3 py-2 border border-slate-300 rounded-lg"><option value="ƒêang tham gia" ${participant.status === 'ƒêang tham gia' ? 'selected' : ''}>ƒêang tham gia</option><option value="ƒê√£ ho√†n th√†nh" ${participant.status === 'ƒê√£ ho√†n th√†nh' ? 'selected' : ''}>ƒê√£ ho√†n th√†nh</option></select></div>
                `;
                showModal(createFormModal('Ch·ªânh s·ª≠a Th√†nh vi√™n', 'edit-participant-form', formContent, 'C·∫≠p nh·∫≠t'));
            }
        }

        // Edit KPI Button (delegated)
        if (e.target.classList.contains('edit-kpi-button')) {
            const year = e.target.dataset.year;
            const kpis = appData[year].kpis;
            const formContent = `
                <input type="hidden" name="year" value="${year}">
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium text-slate-600 mb-1">T·ªïng th√†nh vi√™n</label><input type="number" name="total" value="${kpis.total}" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div>
                    <div><label class="block text-sm font-medium text-slate-600 mb-1">Nh√¢n t√†i ph√°t tri·ªÉn</label><input type="number" name="talent" value="${kpis.talent}" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div>
                    <div><label class="block text-sm font-medium text-slate-600 mb-1">T·ª∑ l·ªá ho√†n th√†nh (%)</label><input type="number" name="rate" value="${kpis.rate}" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div>
                    <div><label class="block text-sm font-medium text-slate-600 mb-1">Kh√≥a h·ªçc t·ªï ch·ª©c</label><input type="number" name="courses" value="${kpis.courses}" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div>
                </div>
            `;
            showModal(createFormModal(`Ch·ªânh s·ª≠a KPI nƒÉm ${year}`, 'edit-kpi-form', formContent, 'C·∫≠p nh·∫≠t'));
        }
        
        // Gemini Suggest IDP Button (delegated)
        if (e.target.classList.contains('gemini-suggest-idp')) {
            const { name, program, status } = e.target.dataset;
            const prompt = `V·ªõi vai tr√≤ l√† m·ªôt c·ªë v·∫•n ph√°t tri·ªÉn s·ª± nghi·ªáp, h√£y g·ª£i √Ω m·ªôt L·ªô tr√¨nh Ph√°t tri·ªÉn C√° nh√¢n (IDP) cho nh√¢n vi√™n t√™n l√† ${name}. H·ªç ƒëang tham gia ch∆∞∆°ng tr√¨nh "${program}" v√† c√≥ tr·∫°ng th√°i "${status}". L·ªô tr√¨nh n√™n bao g·ªìm: 1. M·ª•c ti√™u ph√°t tri·ªÉn ch√≠nh. 2. Ba h√†nh ƒë·ªông c·ª• th·ªÉ ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c m·ª•c ti√™u. 3. C√°c ngu·ªìn l·ª±c/h·ªó tr·ª£ c·∫ßn thi·∫øt. Tr√¨nh b√†y b·∫±ng ti·∫øng Vi·ªát, ƒë·ªãnh d·∫°ng markdown.`;
            callGeminiAPI(prompt, `‚ú® G·ª£i √Ω IDP cho ${name}`);
        }

        // Talent Tab Buttons (delegated)
        if (e.target.classList.contains('talent-tab')) {
            const index = e.target.dataset.index;
            document.querySelectorAll('.talent-tab').forEach(t => t.classList.remove('text-sky-600', 'border-sky-600'));
            e.target.classList.add('text-sky-600', 'border-sky-600');
            document.querySelectorAll('.talent-content').forEach(c => c.classList.add('hidden'));
            const contentToShow = Array.from(document.querySelectorAll('.talent-content'))[index];
            if(contentToShow) contentToShow.classList.remove('hidden');
        }
        
        // Talent Gemini Buttons (delegated)
        if (e.target.classList.contains('gemini-suggest-activity')) {
            const programName = e.target.dataset.programName;
            const prompt = `V·ªõi vai tr√≤ l√† m·ªôt chuy√™n gia thi·∫øt k·∫ø ƒë√†o t·∫°o, h√£y g·ª£i √Ω 3 ho·∫°t ƒë·ªông ph√°t tri·ªÉn s√°ng t·∫°o cho ch∆∞∆°ng tr√¨nh "${programName}". C√°c g·ª£i √Ω n√™n t·∫≠p trung v√†o k·ªπ nƒÉng th·ª±c t·∫ø, g·∫Øn k·∫øt ƒë·ªôi ng≈© v√† th√∫c ƒë·∫©y t∆∞ duy l√£nh ƒë·∫°o. Tr√¨nh b√†y b·∫±ng ti·∫øng Vi·ªát, ƒë·ªãnh d·∫°ng markdown.`;
            callGeminiAPI(prompt, `‚ú® G·ª£i √Ω cho ch∆∞∆°ng tr√¨nh "${programName}"`);
        } else if (e.target.classList.contains('gemini-interview-questions')) {
            const programName = e.target.dataset.programName;
            const prompt = `V·ªõi vai tr√≤ l√† m·ªôt chuy√™n gia tuy·ªÉn d·ª•ng, h√£y t·∫°o 5 c√¢u h·ªèi ph·ªèng v·∫•n h√†nh vi (behavioral interview questions) ƒë·ªÉ ƒë√°nh gi√° ·ª©ng vi√™n cho ch∆∞∆°ng tr√¨nh "${programName}". C√°c c√¢u h·ªèi c·∫ßn t·∫≠p trung v√†o vi·ªác ƒë√°nh gi√° ti·ªÅm nƒÉng l√£nh ƒë·∫°o, kh·∫£ nƒÉng gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ, v√† s·ª± nhanh nh·∫°y trong h·ªçc h·ªèi. Tr√¨nh b√†y b·∫±ng ti·∫øng Vi·ªát, ƒë·ªãnh d·∫°ng markdown.`;
            callGeminiAPI(prompt, `‚ú® C√¢u h·ªèi ph·ªèng v·∫•n cho "${programName}"`);
        }
    });

    modalContainer.addEventListener('submit', e => {
        e.preventDefault();
        const form = e.target;
        if (form.id === 'gemini-form') { hideModal(form.closest('.modal-container')); return; }

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        if (form.id === 'add-participant-form' || form.id === 'edit-participant-form') {
            const yearData = appData[state.selectedYear];
            const id = parseInt(data.id);
            const index = yearData.participants.findIndex(p => p.id === id);
            const newParticipant = { id: id, name: data.full_name, program: data.program_name, status: data.status };
            if (index > -1) {
                yearData.participants[index] = newParticipant;
            } else {
                yearData.participants.push(newParticipant);
            }
        } else if (form.id === 'add-program-form') {
             appData[state.selectedYear].talent.push({ name: data.program_name, goal: data.goal, result: data.result });
        } else if (form.id === 'edit-kpi-form') {
            appData[data.year].kpis = { total: parseInt(data.total), talent: parseInt(data.talent), rate: parseInt(data.rate), courses: parseInt(data.courses) };
        }
        
        hideModal(form.closest('.modal-container'));
        render();
    });

    // --- Direct Button Event Listeners (with null checks) ---
    const geminiAnalyzeKpiBtn = document.getElementById('gemini-analyze-kpi');
    if (geminiAnalyzeKpiBtn) geminiAnalyzeKpiBtn.addEventListener('click', () => {
        const data = appData[state.selectedYear];
        const prompt = `V·ªõi vai tr√≤ l√† m·ªôt chuy√™n gia ph√¢n t√≠ch nh√¢n s·ª±, h√£y ph√¢n t√≠ch c√°c ch·ªâ s·ªë hi·ªáu su·∫•t (KPI) c·ªßa ch∆∞∆°ng tr√¨nh "High Performance" nƒÉm ${state.selectedYear}. D·ªØ li·ªáu: T·ªïng th√†nh vi√™n: ${data.kpis.total}, Nh√¢n t√†i ph√°t tri·ªÉn: ${data.kpis.talent}, T·ª∑ l·ªá ho√†n th√†nh: ${data.kpis.rate}%, Kh√≥a h·ªçc t·ªï ch·ª©c: ${data.kpis.courses}. Vui l√≤ng cung c·∫•p: 1. **Ph√¢n t√≠ch ng·∫Øn g·ªçn:** N√™u b·∫≠t ƒëi·ªÉm m·∫°nh v√† lƒ©nh v·ª±c c·∫ßn c·∫£i thi·ªán. 2. **ƒê·ªÅ xu·∫•t h√†nh ƒë·ªông:** ƒê∆∞a ra 3 ƒë·ªÅ xu·∫•t c·ª• th·ªÉ ƒë·ªÉ c·∫£i thi·ªán. Tr√¨nh b√†y b·∫±ng ti·∫øng Vi·ªát, ƒë·ªãnh d·∫°ng markdown.`;
        callGeminiAPI(prompt, `‚ú® Ph√¢n t√≠ch KPI nƒÉm ${state.selectedYear}`);
    });

    const geminiDraftBtn = document.getElementById('gemini-draft-button');
    if (geminiDraftBtn) geminiDraftBtn.addEventListener('click', () => {
        const topic = document.getElementById('draft-topic-input').value.trim();
        if (!topic) { alert("Vui l√≤ng nh·∫≠p ch·ªß ƒë·ªÅ c·∫ßn so·∫°n th·∫£o."); return; }
        const prompt = `V·ªõi vai tr√≤ l√† m·ªôt chuy√™n vi√™n truy·ªÅn th√¥ng n·ªôi b·ªô, h√£y gi√∫p t√¥i so·∫°n m·ªôt th√¥ng b√°o chuy√™n nghi·ªáp v√† h·∫•p d·∫´n qua email v·ªÅ ch·ªß ƒë·ªÅ sau: "${topic}". Th√¥ng b√°o c·∫ßn c√≥ ti√™u ƒë·ªÅ thu h√∫t, n·ªôi dung r√µ r√†ng, v√† l·ªùi k√™u g·ªçi h√†nh ƒë·ªông (n·∫øu c√≥). Tr√¨nh b√†y b·∫±ng ti·∫øng Vi·ªát.`;
        callGeminiAPI(prompt, `‚ú® So·∫°n th·∫£o v·ªÅ: "${topic}"`);
    });
    
    const geminiFeedbackBtn = document.getElementById('gemini-feedback-button');
    if (geminiFeedbackBtn) geminiFeedbackBtn.addEventListener('click', () => {
        const notes = document.getElementById('feedback-input').value.trim();
        if (!notes) { alert("Vui l√≤ng nh·∫≠p c√°c quan s√°t v·ªÅ nh√¢n vi√™n."); return; }
        const prompt = `V·ªõi vai tr√≤ l√† m·ªôt qu·∫£n l√Ω nh√¢n s·ª± gi√†u kinh nghi·ªám, h√£y chuy·ªÉn c√°c ghi ch√∫ sau th√†nh m·ªôt ƒëo·∫°n ph·∫£n h·ªìi hi·ªáu su·∫•t c√≥ c·∫•u tr√∫c, chuy√™n nghi·ªáp v√† mang t√≠nh x√¢y d·ª±ng. S·ª≠ d·ª•ng ng√¥n ng·ªØ t√≠ch c·ª±c, t·∫≠p trung v√†o h√†nh vi v√† ƒë∆∞a ra g·ª£i √Ω ph√°t tri·ªÉn. Ghi ch√∫: "${notes}". Vui l√≤ng tr√¨nh b√†y theo c·∫•u tr√∫c: ƒêi·ªÉm m·∫°nh, ƒêi·ªÉm c·∫ßn c·∫£i thi·ªán, v√† G·ª£i √Ω h√†nh ƒë·ªông. Tr√¨nh b√†y b·∫±ng ti·∫øng Vi·ªát, ƒë·ªãnh d·∫°ng markdown.`;
        callGeminiAPI(prompt, `‚ú® G·ª£i √Ω Ph·∫£n h·ªìi Hi·ªáu su·∫•t`);
    });
    
    const geminiCourseBtn = document.getElementById('gemini-course-button');
    if (geminiCourseBtn) geminiCourseBtn.addEventListener('click', () => {
        const topic = document.getElementById('course-topic-input').value.trim();
        if (!topic) { alert("Vui l√≤ng nh·∫≠p ch·ªß ƒë·ªÅ kh√≥a h·ªçc."); return; }
        const prompt = `V·ªõi vai tr√≤ l√† m·ªôt chuy√™n gia thi·∫øt k·∫ø ch∆∞∆°ng tr√¨nh ƒë√†o t·∫°o (Instructional Designer), h√£y t·∫°o m·ªôt ƒë·ªÅ c∆∞∆°ng chi ti·∫øt cho kh√≥a h·ªçc v·ªõi ch·ªß ƒë·ªÅ: "${topic}". ƒê·ªÅ c∆∞∆°ng c·∫ßn bao g·ªìm: 1. M·ª•c ti√™u h·ªçc t·∫≠p (Learning Objectives). 2. C·∫•u tr√∫c c√°c h·ªçc ph·∫ßn (Modules). 3. C√°c ch·ªß ƒë·ªÅ ch√≠nh trong m·ªói h·ªçc ph·∫ßn. Tr√¨nh b√†y b·∫±ng ti·∫øng Vi·ªát, ƒë·ªãnh d·∫°ng markdown chuy√™n nghi·ªáp.`;
        callGeminiAPI(prompt, `‚ú® ƒê·ªÅ c∆∞∆°ng Kh√≥a h·ªçc: ${topic}`);
    });
    
    const geminiJdBtn = document.getElementById('gemini-jd-button');
    if (geminiJdBtn) geminiJdBtn.addEventListener('click', () => {
        const title = document.getElementById('jd-title-input').value.trim();
        const responsibilities = document.getElementById('jd-responsibilities-input').value.trim();
        if (!title || !responsibilities) { alert("Vui l√≤ng nh·∫≠p Ch·ª©c danh v√† Tr√°ch nhi·ªám ch√≠nh."); return; }
        const prompt = `V·ªõi vai tr√≤ l√† m·ªôt chuy√™n gia tuy·ªÉn d·ª•ng, h√£y vi·∫øt m·ªôt b·∫£n M√¥ t·∫£ C√¥ng vi·ªác (Job Description) ho√†n ch·ªânh v√† h·∫•p d·∫´n cho v·ªã tr√≠ "${title}". C√°c tr√°ch nhi·ªám ch√≠nh bao g·ªìm:\n${responsibilities}\n\nB·∫£n m√¥ t·∫£ c·∫ßn c√≥ c√°c ph·∫ßn sau: M√¥ t·∫£ chung v·ªÅ c√¥ng vi·ªác, Tr√°ch nhi·ªám ch√≠nh (d·ª±a tr√™n c√°c √Ω ƒë√£ cho), Y√™u c·∫ßu v·ªÅ k·ªπ nƒÉng v√† kinh nghi·ªám, v√† Quy·ªÅn l·ª£i. S·ª≠ d·ª•ng ng√¥n ng·ªØ chuy√™n nghi·ªáp, thu h√∫t ·ª©ng vi√™n. Tr√¨nh b√†y b·∫±ng ti·∫øng Vi·ªát.`;
        callGeminiAPI(prompt, `‚ú® M√¥ t·∫£ C√¥ng vi·ªác: ${title}`);
    });

    // --- INITIALIZATION ---
    render();
});
</script>

</body>
</html>
